@model WebTimKiemPhongTro.Models.TinDang
@{
    ViewBag.Title = "DangTin";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<!-- Sub banner start -->
<div class="sub-banner">
    <div class="container">
        <div class="breadcrumb-area">
            <h1>Trang Đăng Tin</h1>
            <ul class="breadcrumbs">
                <li><a href="/Home/Home">Trang chủ</a></li>
                <li class="active">Đăng tin</li>
            </ul>
        </div>
    </div>
</div>
<!-- Sub banner end -->
<!-- User page start -->
<div class="user-page submit-property content-area-7">
    <div class="container">
        <div class="row" >

            <div class="col-lg-12">
                <div class="search-area contact-2">
                    <div class="search-area-inner">
                        <div class="search-contents ">
                            @using (Ajax.BeginForm("ImageSave", "User", new AjaxOptions() { HttpMethod = "POST" }, new { id = "frmTaskSave", enctype = "multipart/form-data" }))
                            {
                                <form method="GET">
                                    <h3 class="heading-3" style="font-weight: bold;">Thôn Tin Cơ Bản</h3>
                                    <h4>Loại Phòng: bạn có thể chọ 1 trong 3 loại sau đây <span style="color:red;">Phòng trọ, Nhà nguyên căn, Căn hộ chung cư</span> <br /><br /></h4>
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    <div class="row mb-30">
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group">
                                                <label>Tiêu đề sản phẩm</label>
                                                @Html.ValidationMessageFor(model => model.TieuDe, "", new { @class = "text-danger" })
                                                @Html.EditorFor(model => model.TieuDe, new { htmlAttributes = new { @class = "form-control", placeholder = "Tiêu đề", name = "property-title" } })

                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group">
                                                <label>Loại phòng</label>
                                                @Html.ValidationMessageFor(model => model.ChuyenMuc, "", new { @class = "text-danger" })
                                                @Html.EditorFor(model => model.ChuyenMuc, new { htmlAttributes = new { @class = "form-control" } })


                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group">
                                                <label>Giá phòng</label>
                                                @Html.ValidationMessageFor(model => model.GiaTien, "", new { @class = "text-danger" })
                                                @Html.EditorFor(model => model.GiaTien, new { htmlAttributes = new { @class = "form-control", placeholder = "VNĐ" } })

                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group">
                                                <label>Diện tích</label>
                                                @Html.ValidationMessageFor(model => model.DienTich, "", new { @class = "text-danger" })
                                                @Html.EditorFor(model => model.DienTich, new { htmlAttributes = new { @class = "form-control", placeholder = "m2" } })

                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group">
                                                <label>Địa chỉ</label>
                                                @Html.ValidationMessageFor(model => model.DiaChi, "", new { @class = "text-danger" })
                                                @Html.EditorFor(model => model.DiaChi, new { htmlAttributes = new { @class = "form-control", placeholder = "Vd: Số nhà tên đường, Tên Phường, Tên Quận, Tên Tỉnh, Việt Nam" } })

                                            </div>
                                        </div>
                                    </div>
                                    <h3 class="heading-3">Chọn Ảnh</h3>
                                    <div class="row mb-45">
                                        <div class="container-fluid col-sm-12 col-sm-offset-1">

                                            <br />
                                            <div class="form-group">

                                                <label class="sr-only" for="description">chon:</label>
                                                <input type="file" name="Image" id="Upimg" class="form-control" multiple>
                                                @Html.ValidationMessageFor(model => model.Image, "", new { @class = "text-danger" })

                                            </div>
                                            <br />

                                            @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>*@

                                        </div>
                                    </div>
                                    <h3 class="heading-3">Mô Tả Chi Tiết</h3>
                                    <div class="row mb-30">
                                        <div class="col-lg-12">
                                            <div class="form-group message">
                                                @Html.ValidationMessageFor(model => model.MoTa, "", new { @class = "text-danger" })
                                                @Html.TextAreaFor(model => model.MoTa, new { @cols = "100", @rows = "8", id = "txt_details", @class = "form-control ", @name = "message", placeholder = "Mô tả chi tiêt đầy đủ về căn nhà...", })

                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="form-group">
                                                <label>Loại tin:</label>
                                                @Html.ValidationMessageFor(model => model.ListLoaiTin, "", new { @class = "text-danger" })
                                                @Html.DropDownList("LoaiTin", new SelectList(Model.ListLoaiTin, "DonGia", "TenLoai"), htmlAttributes: new { @id = "loaitin", @class = "form-control text-center" })

                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6">
                                            <div class="form-group">
                                                <label>Số lượng ngày đăng:</label>
                                                <select class="selectpicker search-fields text-center" name="SoNgay" id="ngay">
                                                    <option value="1"> 1 Ngày</option>
                                                    <option value="2"> 2 Ngày </option>
                                                    <option value="3"> 3 ngày </option>
                                                    <option value="4"> 4 ngày </option>
                                                    <option value="5" selected> 5 ngày </option>
                                                    <option value="6"> 6 ngày </option>
                                                    <option value="7"> 7 ngày </option>
                                                    <option value="14"> 2 tuần </option>
                                                    <option value="21"> 3 tuần </option>
                                                    <option value="30"> 1 tháng </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mb-45">
                                        <div class="col-lg-6">
                                            <label>Tổng Tiền Thanh Toán</label>
                                            <table class="table table_banggia table-bordered">
                                                <thead>
                                                    <tr>
                                                        <td style="font-weight: bold;" class="text-center" width="30%">Đơn giá</td>
                                                        <td style="font-weight: bold;" class="text-center" width="30%"><span class="lblPackage">Thời gian</span></td>
                                                        <td style="font-weight: bold;" class="text-center" width="30%">Thành tiền</td>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="text-center dongia" id="dongia">15.000</td>
                                                        <td class="text-center tongngay" id="tongngay">5 ngày</td>
                                                        <td class="text-center thanhtien" id="thanhtien">75.000</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Bảng Giá Đăng Tin</label>
                                            <table class="table table_banggia table-bordered">
                                                <thead>
                                                    <tr>
                                                        <th class="text-center" style="text-align: left;">Loại tin</th>
                                                        @foreach (var item in Model.ListLoaiTin)
                                                        {
                                                            <th><span style="color: #B32626; font-weight: bold;">@item.TenLoai</span></th>


                                                        }

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="text-center dongia" id="dongia">Gói ngày</td>
                                                        @foreach (var item in Model.ListLoaiTin)
                                                        {
                                                            <td align="right">
                                                                <span class="spanprice">  @Html.FormatValue(@item.DonGia, "{0:#,###}") <span style="color: #898989;">đ/ngày</span></span>
                                                            </td>



                                                        }

                                                    </tr>
                                                </tbody>
                                            </table>
                                            <br /><br />

                                        </div>
                                        <div class="row ">
                                            <div class="col-lg-12 ">
                                                <button type="submit" id="xacnhan" class="btn btn-md btn-color" name="finish"> Đăng Tin</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            }
                        </div>


                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

@section scripts{
    <script>
        function formatNumber(num) {
            return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
        }
        $(document).ready(function () {
            $("#ngay").change(function () {
                var end = this.value;
                var val1 = $('#loaitin option:selected').val();
                var val = $('#ngay option:selected').text();
                $('#dongia').text(formatNumber(val1));
                $('#tongngay').text(val);
                $('#thanhtien').text(formatNumber(end * val1));
            });
            $("#loaitin").change(function () {

                var end = this.value;
                var val1 = $('#ngay option:selected').val();
                var val = $('#ngay option:selected').text();
                $('#dongia').text(formatNumber( end));
                $('#tongngay').text(val);
                $('#thanhtien').text(formatNumber(end * val1));
            });
            $("#xacnhan").click(function () {
                var thanhtien = $('#ngay option:selected').val() * $('#loaitin option:selected').val();
                var tien = @ViewBag.vitien;
                if (thanhtien > tien) {
                    alert("Tài Khoản của bạn ko đủ để thực hiện, Vui Lòng Nạp Tiền!");
                }
            });
        });

    </script>
    <script>
        ClassicEditor
            .create(document.querySelector('#txt_details'), {
                // toolbar: [ 'heading', '|', 'bold', 'italic', 'link' ]
            })
            .then(editor => {
                window.editor = editor;
            })
            .catch(err => {
                console.error(err.stack);
            });
    </script>
    <script>
    $(document).ready(function () {
        $('#frmTaskSave').submit(function (e) {
            var fdata = new FormData($('#frmTaskSave').get(0));
            var profilephoto = $('#Upimg').val();
            fdata.append("Upimg", profilephoto);
            var fileInput = document.getElementById('Upimg');
            if (fileInput.files.length > 0) {
                for (i = 0; i < fileInput.files.length; i++) {
                    var sfilename = fileInput.files[i].name;
                    let srandomid = Math.random().toString(36).substring(7);
                    fdata.append(sfilename, fileInput.files[i]);
                    var markup = "<tr id='" + srandomid + "'><td>" + sfilename + "</td><td><a href='#' onclick='DeleteFile(\"" + srandomid + "\",\"" + sfilename +
                        "\")'><span class='glyphicon glyphicon-remove red'></span></a></td></tr>"; // Binding the file name
                    // $("#FilesList tbody").append(markup);
                }
                fdata.append('files', profilephoto);
                var name = $('#Name').val();
                if (name) {
                    fdata.append("Name", name);
                    fdata.append("Upimg", profilephoto);
                    $.ajax({
                        type: "Post",
                        url: '@Url.Action("ImageSave", "Default")',
                        data: fdata,
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            $("#myModal").html(data);
                        }
                    });
                }
            }
        });
    });
    </script>
}