@model WebTimKiemPhongTro.Models.TinDang
@{
    ViewBag.Title = "DangTin";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.2/basic.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.2/min/dropzone.min.js"></script>


<div class="row">
    @using (Ajax.BeginForm("ImageSave", "User", new AjaxOptions() { HttpMethod = "POST" }, new { id = "frmTaskSave", enctype = "multipart/form-data" }))
    {
        <div class="col-sm-10 col-sm-offset-1 profiel-container">

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="clear">
                <br>
                @*<hr>*@
                <br>
                <div class="col-sm-offset-1 col-sm-10">
                    <div class="form-group">
                        <label>Tiêu Đề :</label>
                        @*<input name="TieuDe" type="text" class="form-control" placeholder="Tiêu Đề">*@
                        @Html.EditorFor(model => model.TieuDe, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.TieuDe, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="col-sm-5 col-sm-offset-1 ">
                    <div class="form-group">
                        <label>Chuyên Mục :</label>
                        @Html.EditorFor(model => model.ChuyenMuc, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.ChuyenMuc, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Giá cho thue :</label>
                        @Html.EditorFor(model => model.GiaTien, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.GiaTien, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Quận</label>

                        <select id="lunchBegins" class="selectpicker" data-live-search="true" data-live-search-style="begins" title="Quận">
                            <option>Quận 1</option>
                            <option>Quân 2</option>
                            <option>Gò Vấp</option>
                            <option>Bình Thạnh</option>
                            <option>Quận 9</option>
                            <option>Thủ Đức</option>
                        </select>
                        @*<input name="website" type="text" class="form-control" placeholder="">*@
                    </div>
                </div>

                <div class="col-sm-5">
                    <div class="form-group">
                        <label>Diện Tích:</label>
                        @Html.EditorFor(model => model.DienTich, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DienTich, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Địa chỉ :</label>
                        @Html.EditorFor(model => model.DiaChi, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.DiaChi, "", new { @class = "text-danger" })
                    </div>
                </div>

            </div>
            <div class="clear">
                <br>
                <hr>
                <br>
                <div class="col-sm-10 col-sm-offset-1">
                    <div class="form-group" style="font-style:unset">
                        Thông Tin Mô Tả
                    </div>
                    <div id="textarea">

                        @Html.TextAreaFor(model => model.MoTa, new { @cols = "100", @rows = "8", id = "txt_details" })
                        @Html.ValidationMessageFor(model => model.MoTa, "", new { @class = "text-danger" })
                        <br />
                    </div>

                </div>

            </div>

            <div class="clear">
                <hr />
                <br />
                <div class="col-sm-10 col-sm-offset-1 ">
                    Chọn hình ảnh minh họa
                </div>
                <div class="container-fluid col-sm-10 col-sm-offset-1">
                    
                        <br />
                        <div class="form-group">

                            <label class="sr-only" for="description">chon:</label>
                            <input type="file" name="Image" id="Upimg" class="form-control" multiple>
                            @Html.ValidationMessageFor(model => model.Image, "", new { @class = "text-danger" })

                        </div>
                    <br />

                    @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>*@

                </div>






            </div>
            <div class="clear">

                <div class="col-sm-5 col-sm-offset-1">

                    <div class="form-group">
                        <label>Loại Tin :</label>
                        @Html.DropDownList("LoaiTin", new SelectList(Model.ListLoaiTin, "DonGia", "TenLoai"), htmlAttributes: new { @id = "loaitin", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.ListLoaiTin, "", new { @class = "text-danger" })
                    </div>
                    <div class="form-group">
                        <label>Chọn Ngày:</label>
                        <br />
                        <select id="ngay" name="SoNgay" class="form-control">
                            <option value="1"> 1 Ngày</option>
                            <option value="2"> 2 Ngày </option>
                            <option value="3"> 3 ngày </option>
                            <option value="4"> 4 ngày </option>
                            <option value="5" selected> 5 ngày </option>
                            <option value="6"> 6 ngày </option>
                            <option value="7"> 7 ngày </option>
                            <option value="14"> 2 tuần </option>
                            <option value="21"> 3 tuần </option>
                            <option value="30"> 1 tháng </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Bảng giá</label>
                        <br />
                        <table class="table table_banggia table-bordered">
                            <thead>
                                <tr>
                                    <td class="text-center" width="30%">Đơn giá</td>
                                    <td class="text-center" width="30%"><span class="lblPackage">Thời gian</span></td>
                                    <td class="text-center" width="30%">Thành tiền</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-center dongia" id="dongia">15.000</td>
                                    <td class="text-center tongngay" id="tongngay">5 ngày</td>
                                    <td class="text-center thanhtien" id="thanhtien">75.000</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="col-sm-5">
                    <div class="form-group">
                        <label>Bảng Giá</label>
                        <br />
                        <table class="table table_banggia table-bordered">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Loại tin</th>
                                    <th style="text-align: right;">Gói ngày</th>

                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.ListLoaiTin)
                                {
                                    <tr>
                                        <td><span style="color: #B32626; font-weight: bold;">@item.TenLoai</span></td>
                                        <td align="right"><span class="spanprice">  @Html.FormatValue(@item.DonGia, "{0:#,###}") <span style="color: #898989;">đ/ngày</span></span></td>

                                    </tr>

                                }
                                @*<tr>
                                    <td><span style="color: #B32626; font-weight: bold;">Tin HOT</span></td>
                                    <td align="right"><span class="spanprice">15.000 <span style="color: #898989;">đ/ngày</span></span></td>

                                </tr>
                                <tr>
                                    <td><span style="color: #f3051b; font-weight: bold;">Tin VIP</span></td>
                                    <td align="right"><span class="spanprice">10.000 <span style="color: #898989;">đ/ngày</span></span></td>

                                </tr>

                                <tr>
                                    <td><span style="color: #055699">Tin thường</span></td>
                                    <td align="right"><span class="spanprice">5.000 <span style="color: #898989;">đ/ngày</span></span></td>

                                </tr>*@
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="clear">
                <div class="col-sm-10 col-sm-offset-1 ">
                    <br>

                    <input type='submit' id="xacnhan" class='btn-primary' name='finish' value='Xác Nhận' />
                </div>

            </div>

        </div>
    }


</div>
<script type="text/javascript" src="~/lib/jquery/dist/jquery.js"></script>



@section scripts{
    <script src="https://cdn.ckeditor.com/ckeditor5/29.1.0/classic/ckeditor.js"></script>
    <script>
        function formatNumber(num) {
            return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
        }
        $(document).ready(function () {
            $("#ngay").change(function () {
                var end = this.value;
                var val1 = $('#loaitin option:selected').val();
                var val = $('#ngay option:selected').text();
                $('#dongia').text(formatNumber(val1));
                $('#tongngay').text(val);
                $('#thanhtien').text(formatNumber(end * val1));
            });
            $("#loaitin").change(function () {

                var end = this.value;
                var val1 = $('#ngay option:selected').val();
                var val = $('#ngay option:selected').text();
                $('#dongia').text(formatNumber( end));
                $('#tongngay').text(val);
                $('#thanhtien').text(formatNumber(end * val1));
            });
            $("#xacnhan").click(function () {
                var thanhtien = $('#ngay option:selected').val() * $('#loaitin option:selected').val();
                var tien = @ViewBag.vitien;
                if (thanhtien > tien) {
                    alert("Tài Khoản của bạn ko đủ để thực hiện, Vui Lòng Nạp Tiền!");
                }
            });
        });

    </script>
    <script>
        ClassicEditor
            .create(document.querySelector('#txt_details'), {
                // toolbar: [ 'heading', '|', 'bold', 'italic', 'link' ]
            })
            .then(editor => {
                window.editor = editor;
            })
            .catch(err => {
                console.error(err.stack);
            });
    </script>
    <script>
    $(document).ready(function () {
        $('#frmTaskSave').submit(function (e) {
            var fdata = new FormData($('#frmTaskSave').get(0));
            var profilephoto = $('#Upimg').val();
            fdata.append("Upimg", profilephoto);
            var fileInput = document.getElementById('Upimg');
            if (fileInput.files.length > 0) {
                for (i = 0; i < fileInput.files.length; i++) {
                    var sfilename = fileInput.files[i].name;
                    let srandomid = Math.random().toString(36).substring(7);
                    fdata.append(sfilename, fileInput.files[i]);
                    var markup = "<tr id='" + srandomid + "'><td>" + sfilename + "</td><td><a href='#' onclick='DeleteFile(\"" + srandomid + "\",\"" + sfilename +
                        "\")'><span class='glyphicon glyphicon-remove red'></span></a></td></tr>"; // Binding the file name
                    // $("#FilesList tbody").append(markup);
                }
                fdata.append('files', profilephoto);
                var name = $('#Name').val();
                if (name) {
                    fdata.append("Name", name);
                    fdata.append("Upimg", profilephoto);
                    $.ajax({
                        type: "Post",
                        url: '@Url.Action("ImageSave", "Default")',
                        data: fdata,
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            $("#myModal").html(data);
                        }
                    });
                }
            }
        });
    });
    </script>
}